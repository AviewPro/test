<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Schrödinger Baseball - Optimized</title>
<style>
body{
    margin:0;
    background:#050507;
    color:#fff;
    font-family:monospace;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding-top:40px;
}
h1{color:#00f2ff;text-shadow:0 0 15px #00f2ff;}
#game{width:320px;text-align:center;}
input{
    width:100px;
    font-size:20px;
    text-align:center;
}
button{
    padding:5px 10px;
    margin-left:5px;
    cursor:pointer;
}
#log{
    margin-top:20px;
    min-height:120px;
    font-size:14px;
    line-height:1.6;
}
#prob{
    margin-top:15px;
    font-size:16px;
    color:#00ff41;
}
.dead{color:#ff4b2b;}
</style>
</head>
<body>

<h1>Schrödinger Baseball</h1>

<div id="game">
    <div>
        <input id="guess" maxlength="3">
        <button id="submit">Guess</button>
    </div>
    <div id="prob"></div>
    <div id="log"></div>
</div>

<script>
const $ = id => document.getElementById(id);

const state = {
    candidates: [],
    turn: 0
};

// 후보 생성 (중복 없는 3자리)
const generateCandidates = () => {
    const arr=[];
    for(let i=0;i<=999;i++){
        const n=i.toString().padStart(3,'0');
        if(new Set(n).size===3) arr.push(n);
    }
    return arr;
};

// Strike/Ball 계산
const calcSB = (g,c)=>{
    let s=0,b=0;
    for(let i=0;i<3;i++){
        if(g[i]===c[i]) s++;
        else if(c.includes(g[i])) b++;
    }
    return `${s}S${b}B`;
};

// AI 응답 (가능성 최대 유지)
const aiResponse = guess=>{
    const outcomes={};
    state.candidates.forEach(c=>{
        const key=calcSB(guess,c);
        if(key==="3S0B") return;
        (outcomes[key]??=[]).push(c);
    });

    let bestKey="",max=-1;
    for(const k in outcomes){
        if(outcomes[k].length>max){
            max=outcomes[k].length;
            bestKey=k;
        }
    }

    if(!bestKey){
        state.candidates=[];
        return "3S0B";
    }

    state.candidates=outcomes[bestKey];
    return bestKey;
};

// UI 업데이트
const updateUI=()=>{
    const prob=state.candidates.length===0
        ? 0
        : (1/state.candidates.length*100);

    $("prob").innerHTML=
        `Probability: ${prob.toFixed(4)}% 
        (${state.candidates.length} candidates)`;

    if(state.candidates.length===0){
        $("prob").classList.add("dead");
        $("log").innerHTML+=
        "<br><b>훈련 완료. 고양이는 죽었을 수도, 살았을 수도 있습니다.</b>";
    }
};

// 입력 처리
$("submit").onclick=()=>{
    const guess=$("guess").value;
    if(!/^\d{3}$/.test(guess)) return;

    state.turn++;
    const result=aiResponse(guess);

    $("log").innerHTML+=
        `${state.turn}. ${guess} → ${result}<br>`;

    updateUI();
    $("guess").value="";
};

// 초기화
state.candidates=generateCandidates();
updateUI();
</script>

</body>
</html>
